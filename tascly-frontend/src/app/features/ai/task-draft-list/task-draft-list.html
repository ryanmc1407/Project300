<!-- I created this template to display the AI-generated draft tasks -->
<!-- This is where managers can review, edit, and approve tasks before they're created -->

<div class="draft-tasks-container">
    <!-- I'm only showing this section if there are draft tasks to display -->
    @if (draftTasks().length > 0) {

    <!-- I'm creating a header with bulk action buttons -->
    <div class="draft-header">
        <div class="header-left">
            <h2 class="draft-title">üìã Proposed Tasks ({{ draftTasks().length }})</h2>
            <p class="draft-subtitle">Review and edit the AI-generated tasks below</p>
        </div>

        <div class="header-actions">
            <!-- I'm showing a select/deselect all button -->
            @if (areAllSelected()) {
            <button class="btn-secondary" (click)="deselectAll()">
                Deselect All
            </button>
            } @else {
            <button class="btn-secondary" (click)="selectAll()">
                Select All
            </button>
            }

            <!-- I'm showing the confirm button with the count of selected tasks -->
            @if (selectedTasks().size > 0) {
            <button class="btn-primary" (click)="confirmSelected()">
                ‚úì Accept {{ selectedTasks().size }} Selected
            </button>
            } @else {
            <button class="btn-primary" (click)="confirmAll()">
                ‚úì Accept All {{ draftTasks().length }}
            </button>
            }
        </div>
    </div>

    <!-- I'm creating the list of draft task cards -->
    <div class="draft-list">
        <!-- I'm looping through each draft task -->
        @for (task of draftTasks(); track task.tempId) {
        <div class="draft-card" [class.selected]="selectedTasks().has(task.tempId)">
            <!-- I'm adding a checkbox for selecting this task -->
            <div class="card-checkbox">
                <input type="checkbox" [checked]="selectedTasks().has(task.tempId)"
                    (change)="toggleSelection(task.tempId)" class="task-checkbox">
            </div>

            <!-- I'm creating the main content area of the card -->
            <div class="card-content">
                <!-- I'm making the title editable -->
                <div class="title-section">
                    <input type="text" class="task-title-input" [value]="task.title"
                        (input)="updateTask(task.tempId, 'title', $any($event.target).value)"
                        placeholder="Task title...">
                </div>

                <!-- I'm creating a row for the task metadata -->
                <div class="metadata-row">
                    <!-- I'm adding a priority selector -->
                    <div class="metadata-item">
                        <label class="metadata-label">Priority:</label>
                        <select [value]="task.priority"
                            (change)="updateTask(task.tempId, 'priority', $any($event.target).value)"
                            class="priority-select" [class]="getPriorityClass(task.priority)">
                            <option value="High">{{ getPriorityIcon('High') }} High</option>
                            <option value="Medium">{{ getPriorityIcon('Medium') }} Medium</option>
                            <option value="Low">{{ getPriorityIcon('Low') }} Low</option>
                        </select>
                    </div>

                    <!-- I'm adding an estimated hours input -->
                    <div class="metadata-item">
                        <label class="metadata-label">Estimate:</label>
                        <div class="hours-input-wrapper">
                            <input type="number" [value]="task.estimatedHours"
                                (input)="updateTask(task.tempId, 'estimatedHours', +$any($event.target).value)"
                                class="hours-input" min="0.5" step="0.5" max="40">
                            <span class="hours-label">hours</span>
                        </div>
                    </div>

                    <!-- I'm adding a type selector -->
                    <div class="metadata-item">
                        <label class="metadata-label">Type:</label>
                        <select [value]="task.type"
                            (change)="updateTask(task.tempId, 'type', $any($event.target).value)" class="type-select"
                            [class]="getTypeClass(task.type)">
                            <option value="Feature">‚ú® Feature</option>
                            <option value="Bug">üêõ Bug</option>
                            <option value="Improvement">üîß Improvement</option>
                        </select>
                    </div>

                    <!-- I'm showing the suggested assignee if the AI provided one -->
                    @if (task.suggestedAssignee) {
                    <div class="metadata-item">
                        <span class="assignee-chip">
                            üë§ {{ task.suggestedAssignee }}
                        </span>
                    </div>
                    }

                    <!-- I'm showing the scheduled time if provided -->
                    @if (task.scheduledStart) {
                    <div class="metadata-item">
                        <label class="metadata-label">Start:</label>
                        <span class="date-chip" [class.today]="isDateToday(task.scheduledStart)">
                            {{ getSmartDateLabel(task.scheduledStart) }}
                        </span>
                    </div>
                    }

                    @if (task.dueDate) {
                    <div class="metadata-item">
                        <label class="metadata-label">Due:</label>
                        <span class="date-chip" [class.today]="isDateToday(task.dueDate)">
                            {{ getSmartDateLabel(task.dueDate) }}
                        </span>
                    </div>
                    }
                </div>

                <!-- I'm making the description editable -->
                <div class="description-section">
                    <label class="metadata-label">Description:</label>
                    <textarea class="task-description-input" [value]="task.description"
                        (input)="updateTask(task.tempId, 'description', $any($event.target).value)"
                        placeholder="Task description..." rows="3">
                    </textarea>
                </div>
            </div>

            <!-- I'm adding a delete button for removing this draft task -->
            <div class="card-actions">
                <button class="delete-btn" (click)="removeTask(task.tempId)" title="Remove this task">
                    üóëÔ∏è
                </button>
            </div>
        </div>
        }
    </div>

    <!-- I'm adding a footer with additional actions -->
    <div class="draft-footer">
        <p class="footer-note">
            üí° Tip: You can edit any field before accepting the tasks
        </p>

        <div class="footer-actions">
            @if (selectedTasks().size > 0) {
            <button class="btn-primary-large" (click)="confirmSelected()">
                ‚úì Create {{ selectedTasks().size }} Task{{ selectedTasks().size > 1 ? 's' : '' }}
            </button>
            } @else {
            <button class="btn-primary-large" (click)="confirmAll()">
                ‚úì Create All {{ draftTasks().length }} Tasks
            </button>
            }
        </div>
    </div>

    } @else {
    <!-- I'm showing a message when there are no draft tasks -->
    <div class="empty-state">
        <div class="empty-icon">üìù</div>
        <h3 class="empty-title">No tasks generated yet</h3>
        <p class="empty-text">Use the AI prompt above to generate tasks</p>
    </div>
    }
</div>