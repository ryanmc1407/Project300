<div class="container-fluid py-4 px-4">
    @if (isLoading()) {
    <div class="d-flex justify-content-center py-5">
        <div class="spinner-border text-primary" role="status"></div>
    </div>
    } @else if (error()) {
    <div class="alert alert-danger">{{ error() }}</div>
    } @else if (project()) {
    <div class="d-flex align-items-center justify-content-between mb-5">
        <div>
            <nav aria-label="breadcrumb">
                <ol class="breadcrumb mb-1">
                    <li class="breadcrumb-item"><a routerLink="/dashboard"
                            class="text-decoration-none text-muted small">Workspaces</a>
                    </li>
                    <li class="breadcrumb-item active small" aria-current="page">{{ project()?.name }}</li>
                </ol>
            </nav>
            <h1 class="h2 fw-bold mb-1">{{ project()?.name }}</h1>
            <p class="text-muted mb-0">{{ project()?.description || 'Build something amazing today.' }}</p>
        </div>
        <div class="d-flex gap-2">
            <button class="btn btn-lime fw-bold px-4 py-2 shadow-sm bento-btn" (click)="createTaskViaAi()">
                <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none"
                    stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"
                    class="me-2">
                    <line x1="12" y1="5" x2="12" y2="19"></line>
                    <line x1="5" y1="12" x2="19" y2="12"></line>
                </svg>
                New Task
            </button>
        </div>
    </div>

    <!-- Filters -->
    <div class="card border-0 shadow-sm mb-4">
        <div class="card-body p-3">
            <div class="row g-3">
                <div class="col-md-6">
                    <div class="input-group input-group-sm">
                        <span class="input-group-text bg-white border-end-0">
                            <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24"
                                fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                                stroke-linejoin="round">
                                <circle cx="11" cy="11" r="8" />
                                <path d="m21 21-4.3-4.3" />
                            </svg>
                        </span>
                        <input type="text" class="form-control border-start-0 ps-0" placeholder="Search tasks..."
                            [value]="searchQuery()" (input)="searchQuery.set($any($event.target).value); filterTasks()">
                    </div>
                </div>
                <div class="col-md-3">
                    <select class="form-select form-select-sm" [value]="selectedStatus()"
                        (change)="selectedStatus.set($any($event.target).value); filterTasks()">
                        <option value="all">All Statuses</option>
                        <option value="to do">To Do</option>
                        <option value="in progress">In Progress</option>
                        <option value="done">Done</option>
                    </select>
                </div>
            </div>
        </div>
    </div>

    <!-- Task List -->
    <div class="row g-3">
        @for (task of filteredTasks(); track task.id) {
        <div class="col-12">
            <div class="card border-0 shadow-sm task-card p-3 h-100">
                <div class="d-flex align-items-center gap-3">
                    <div class="status-indicator" [ngClass]="getStatusClass(task.statusName)"></div>
                    <div class="flex-grow-1">
                        <h6 class="fw-bold mb-1">{{ task.name }}</h6>
                        <p class="text-muted small mb-0 text-truncate" style="max-width: 500px;">{{ task.description
                            }}
                        </p>
                    </div>
                    <div class="d-flex align-items-center gap-4">
                        <div class="text-end" style="min-width: 100px;">
                            <span class="badge border fw-bold text-uppercase"
                                [ngClass]="getImportanceClass(task.importanceName)" style="font-size: 0.65rem;">
                                {{ task.importanceName }}
                            </span>
                        </div>
                        <div class="text-end text-muted small" style="min-width: 80px;">
                            {{ task.dueDate | date:'MMM d' }}
                        </div>
                        <button class="btn btn-light border btn-sm p-1 rounded-2 text-danger hover-delete"
                            (click)="deleteTask(task.id)">
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24"
                                fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                                stroke-linejoin="round">
                                <path d="M3 6h18" />
                                <path d="M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6" />
                                <path d="M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2" />
                            </svg>
                        </button>
                    </div>
                </div>
            </div>
        </div>
        } @empty {
        <div class="col-12 text-center py-5 opacity-50">
            <svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" viewBox="0 0 24 24" fill="none"
                stroke="currentColor" stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="mb-3">
                <path d="M12 20h9" />
                <path d="M16.5 3.5a2.12 2.12 0 0 1 3 3L7 19l-4 1 1-4Z" />
            </svg>
            <p>No tasks found for this project.</p>
        </div>
        }
    </div>
    }
</div>